<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="../css/style.css">

        <!-- <script src="./js/nav.js" ></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


        
        <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
        <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
        
        <title>d3 charts</title>
    </head>

    <body>
        
      

        <div class="wrapper">
          <div class="sidebar">
              <h2>Sidebar</h2>
              <ul>
                  <li><a href="../index.html"><i class="fas fa-home"></i>Home</a></li>
                  <li><a href="../d3js/Bar/bar.html"><i class="fas fa-user"></i>Bar</a></li>
                  <li><a href="/"><i class="fas fa-address-card"></i>Line</a></li>
                  <li><a href="#"><i class="fas fa-project-diagram"></i>portfolio</a></li>
                  <li><a href="#"><i class="fas fa-blog"></i>Blogs</a></li>
                  <li><a href="#"><i class="fas fa-address-book"></i>Contact</a></li>
                  <li><a href="../news.html"><i class="fas fa-address-book"></i>News</a></li>
                  <li><a href="../FAQ.html"><i class="fas fa-address-book"></i>FAQ</a></li>
                  <li><a href="#"><i class="fas fa-map-pin"></i>Map</a></li>
              </ul> 

          </div>

          <div class="main_content">
            <div class="container" id="content" >
                <!-- <svg width="600" height="500"></svg> -->
            </div>
          </div>
            
        </div>

<script>     
            var xhr = new XMLHttpRequest(); //invoke a new instance of the XMLHttpRequest
            xhr.onload = success; // call success function if request is successful
            xhr.onerror = error;  // call error function if request failed
            xhr.open('GET', 'https://data.nepalcorona.info/api/v1/covid/timeline'); // open a GET request
            xhr.send(); // send the request to the server.

            // function to handle error
            function error(err) {
                console.log('Request Failed', err); //error details will be in the "err" object
            }

            // function to handle success
            function success() {
                var timeline_data = JSON.parse(this.responseText); //parse the string to JSON
                console.log(timeline_data);
                console.log("data fetched successfully");
            



//------------------------1. PREPARATION------------------------//
//-----------------------------SVG------------------------------//
const width = 960;
const height = 500;
const margin = 5;
const padding = 5;
const adj = 30;
// we are appending SVG first
const svg = d3.select("div#container").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);

//-----------------------------DATA-----------------------------//
const timeConv = d3.timeParse("%d-%b-%Y");
// const dataset = d3.json("https://data.nepalcorona.info/api/v1/covid/timeline");
const dataset = d3.request("https://data.nepalcorona.info/api/v1/covid/timeline")
   .header("X-Requested-With", "XMLHttpRequest")
   .header("Content-Type", "application/x-www-form-urlencoded")
   .post("a = 2&b = 3", callback);
dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: timeConv(d.date),
                    measurement: +d[id]
                };
            })
        };
    });

//----------------------------SCALES----------------------------//
const xScale = d3.scaleTime().range([0,width]);
const yScale = d3.scaleLinear().rangeRound([height, 0]);

xScale.domain(d3.extent(data, function(d){
    return timeConv(d.date)}));

yScale.domain([(0), d3.max(slices, function(c) {
    return d3.max(c.values, function(d) {
        return d.measurement + 4; });
        })
    ]);

//-----------------------------AXES-----------------------------//
const yaxis = d3.axisLeft()
    .ticks((slices[0].values).length)
    .scale(yScale);

const xaxis = d3.axisBottom()
    .ticks(d3.timeDay.every(1))
    .tickFormat(d3.timeFormat('%b %d'))
    .scale(xScale);

//----------------------------LINES-----------------------------//
const line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); });

let id = 0;
const ids = function () {
    return "line-"+id++;
}  

//---------------------------TOOLTIP----------------------------//


//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xaxis);

svg.append("g")
    .attr("class", "axis")
    .call(yaxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("dy", ".75em")
    .attr("y", 6)
    .style("text-anchor", "end")
    .text("Frequency");

//----------------------------LINES-----------------------------//
const lines = svg.selectAll("lines")
    .data(slices)
    .enter()
    .append("g");

    lines.append("path")
    .attr("class", ids)
    .attr("d", function(d) { return line(d.values); });

    lines.append("text")
    .attr("class","serie_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 10)  
            + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
    .attr("x", 5)
    .text(function(d) { return ("Serie ") + d.id; });

//---------------------------POINTS-----------------------------// 

//---------------------------EVENTS-----------------------------// 

});
}
</script>
</body>
</html>